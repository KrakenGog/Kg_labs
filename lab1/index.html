<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лабораторная работа №1: Цветовые модели (Валидация)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #4a4a4a;
        }

        .controls-top {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-preview {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            border: 2px solid #ddd;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background-color: rgb(0, 0, 0);
            transition: background-color 0.1s;
        }

        .main-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
        }

        .model-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 300px;
            display: flex;
            flex-direction: column;
        }

        .model-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            text-align: center;
            color: #555;
        }

        .input-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .label {
            width: 30px;
            font-weight: bold;
        }

        input[type="range"] {
            flex-grow: 1;
            cursor: pointer;
        }

        input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        
        input:invalid {
            border-color: red;
        }
    </style>
</head>
<body>

    <h1>Конвертер (RGB, CMYK, HLS)</h1>

    <div class="controls-top">
        <div>
            <label for="global-picker">Палитра:</label>
            <input type="color" id="global-picker" value="#000000">
        </div>
        <div id="color-box" class="color-preview"></div>
    </div>

    <div class="main-container">
        
        <div class="model-card" id="card-rgb">
            <div class="model-title">RGB (0-255)</div>
            <div class="input-group">
                <span class="label" style="color:red">R</span>
                <input type="range" min="0" max="255" id="rgb-r-range">
                <input type="number" min="0" max="255" id="rgb-r-input">
            </div>
            <div class="input-group">
                <span class="label" style="color:green">G</span>
                <input type="range" min="0" max="255" id="rgb-g-range">
                <input type="number" min="0" max="255" id="rgb-g-input">
            </div>
            <div class="input-group">
                <span class="label" style="color:blue">B</span>
                <input type="range" min="0" max="255" id="rgb-b-range">
                <input type="number" min="0" max="255" id="rgb-b-input">
            </div>
        </div>

        
        <div class="model-card" id="card-cmyk">
            <div class="model-title">CMYK (0-100)</div>
            <div class="input-group">
                <span class="label" style="color:cyan">C</span>
                <input type="range" min="0" max="100" id="cmyk-c-range">
                <input type="number" min="0" max="100" id="cmyk-c-input">
            </div>
            <div class="input-group">
                <span class="label" style="color:magenta">M</span>
                <input type="range" min="0" max="100" id="cmyk-m-range">
                <input type="number" min="0" max="100" id="cmyk-m-input">
            </div>
            <div class="input-group">
                <span class="label" style="color:#cccc00">Y</span>
                <input type="range" min="0" max="100" id="cmyk-y-range">
                <input type="number" min="0" max="100" id="cmyk-y-input">
            </div>
            <div class="input-group">
                <span class="label">K</span>
                <input type="range" min="0" max="100" id="cmyk-k-range">
                <input type="number" min="0" max="100" id="cmyk-k-input">
            </div>
        </div>

        
        <div class="model-card" id="card-hls">
            <div class="model-title">HLS (H:0-360, LS:0-100)</div>
            <div class="input-group">
                <span class="label">H</span>
                <input type="range" min="0" max="360" id="hls-h-range">
                <input type="number" min="0" max="360" id="hls-h-input">
            </div>
            <div class="input-group">
                <span class="label">L</span>
                <input type="range" min="0" max="100" id="hls-l-range">
                <input type="number" min="0" max="100" id="hls-l-input">
            </div>
            <div class="input-group">
                <span class="label">S</span>
                <input type="range" min="0" max="100" id="hls-s-range">
                <input type="number" min="0" max="100" id="hls-s-input">
            </div>
        </div>
    </div>

    <script>
        let currentRGB = { r: 0, g: 0, b: 0 };
        let blockUpdate = false; 

        
        function rgbToCmyk(r, g, b) {
            let c = 1 - (r / 255), m = 1 - (g / 255), y = 1 - (b / 255);
            let k = Math.min(c, m, y);
            if (k === 1) return { c: 0, m: 0, y: 0, k: 100 };
            let c1 = (c - k) / (1 - k), m1 = (m - k) / (1 - k), y1 = (y - k) / (1 - k);
            return { c: Math.round(c1 * 100), m: Math.round(m1 * 100), y: Math.round(y1 * 100), k: Math.round(k * 100) };
        }

        function cmykToRgb(c, m, y, k) {
            c/=100; m/=100; y/=100; k/=100;
            let r = 1 - Math.min(1, c * (1 - k) + k);
            let g = 1 - Math.min(1, m * (1 - k) + k);
            let b = 1 - Math.min(1, y * (1 - k) + k);
            return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
        }

        function rgbToHls(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            if (max === min) h = s = 0;
            else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return { h: Math.round(h * 360), l: Math.round(l * 100), s: Math.round(s * 100) };
        }

        function hlsToRgb(h, l, s) {
            h /= 360; l /= 100; s /= 100;
            let r, g, b;
            if (s === 0) r = g = b = l; 
            else {
                let q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                let p = 2 * l - q;
                const hue = (t) => {
                    if(t < 0) t += 1; if(t > 1) t -= 1;
                    if(t < 1/6) return p + (q - p) * 6 * t;
                    if(t < 1/2) return q;
                    if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                r = hue(h + 1/3); g = hue(h); b = hue(h - 1/3);
            }
            return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }
        function hexToRgb(hex) {
            let bigint = parseInt(hex.slice(1), 16);
            return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
        }

        
        function getValidValue(id, min, max) {
            const input = document.getElementById(id + '-input');
            let val = parseInt(input.value);

            
            if (isNaN(val)) {
                val = min;
            }

            
            if (val < min) val = min;
            if (val > max) val = max;

            
            if (input.value != val.toString() && input.value !== "") {
                input.value = val;
            }

            return val;
        }


        

        function updateUI(sourceModel) {
            blockUpdate = true;

            document.getElementById('color-box').style.backgroundColor = `rgb(${currentRGB.r}, ${currentRGB.g}, ${currentRGB.b})`;
            
            if (sourceModel !== 'picker') {
                document.getElementById('global-picker').value = rgbToHex(currentRGB.r, currentRGB.g, currentRGB.b);
            }

            if (sourceModel !== 'rgb') {
                setInputs('rgb-r', currentRGB.r);
                setInputs('rgb-g', currentRGB.g);
                setInputs('rgb-b', currentRGB.b);
            }

            if (sourceModel !== 'cmyk') {
                const cmyk = rgbToCmyk(currentRGB.r, currentRGB.g, currentRGB.b);
                setInputs('cmyk-c', cmyk.c);
                setInputs('cmyk-m', cmyk.m);
                setInputs('cmyk-y', cmyk.y);
                setInputs('cmyk-k', cmyk.k);
            }

            if (sourceModel !== 'hls') {
                const hls = rgbToHls(currentRGB.r, currentRGB.g, currentRGB.b);
                setInputs('hls-h', hls.h);
                setInputs('hls-l', hls.l);
                setInputs('hls-s', hls.s);
            }

            blockUpdate = false;
        }

        function setInputs(prefix, value) {
            document.getElementById(`${prefix}-range`).value = value;
            document.getElementById(`${prefix}-input`).value = value;
        }

        

        function attachListeners(ids, modelName, callback) {
            ids.forEach(id => {
                const elRange = document.getElementById(id + '-range');
                const elInput = document.getElementById(id + '-input');
                
                const handler = (e) => {
                    if(blockUpdate) return;
                    
                    
                    if(e.target.type === 'range') {
                        elInput.value = e.target.value;
                    } else {
                        elRange.value = e.target.value; 
                    }

                    callback(); 
                    updateUI(modelName); 
                };

                elRange.addEventListener('input', handler);
                elInput.addEventListener('input', handler);
            });
        }

        
        attachListeners(['rgb-r', 'rgb-g', 'rgb-b'], 'rgb', () => {
            currentRGB.r = getValidValue('rgb-r', 0, 255);
            currentRGB.g = getValidValue('rgb-g', 0, 255);
            currentRGB.b = getValidValue('rgb-b', 0, 255);
        });

        
        attachListeners(['cmyk-c', 'cmyk-m', 'cmyk-y', 'cmyk-k'], 'cmyk', () => {
            const c = getValidValue('cmyk-c', 0, 100);
            const m = getValidValue('cmyk-m', 0, 100);
            const y = getValidValue('cmyk-y', 0, 100);
            const k = getValidValue('cmyk-k', 0, 100);
            currentRGB = cmykToRgb(c, m, y, k);
        });

        
        attachListeners(['hls-h', 'hls-l', 'hls-s'], 'hls', () => {
            const h = getValidValue('hls-h', 0, 360);
            const l = getValidValue('hls-l', 0, 100);
            const s = getValidValue('hls-s', 0, 100);
            currentRGB = hlsToRgb(h, l, s);
        });

        
        document.getElementById('global-picker').addEventListener('input', (e) => {
            if(blockUpdate) return;
            currentRGB = hexToRgb(e.target.value);
            updateUI('picker');
        });

       
        updateUI('none');

    </script>
</body>
</html>
